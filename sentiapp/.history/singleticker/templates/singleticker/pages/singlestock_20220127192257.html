{% extends "singleticker/base.html" %} {% block content %}

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/solid.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<div id="app" class="container">
    <div class="row">
        <div id="ticke-title">
            <h1> $TSL </h1>
        </div>
    </div>
    <div class="row">
        <div id="left-ticker-container" class="col-sm">

            <div id="ticker-price">
                <div>
                    <h1> [[currentPrice]] </h1>
                </div>
                <div>
                    <p> + 2.60% ($74.72) </p>
                </div>
            </div>

        </div>




        <div id="left-ticker-container" class="col-sm">

            <div id="ticker-overview">
                <div class="row">

                    <div class="col">
                        <p> Market Cap : 123</p>
                    </div>
                    <div class="col">
                        <p> Market Cap : 123</p>
                    </div>
                    <div class="col">
                        <p> Market Cap : 123</p>
                    </div>


                    <div class="w-100"></div>
                    <div class="col">
                        <p> Market Cap : 123</p>
                    </div>
                    <div class="col">
                        <p> Market Cap : 123</p>
                    </div>
                    <div class="col">
                        <p> Market Cap : 123</p>
                    </div>

                    <div class="w-100"></div>
                    <div class="col">
                        <p> Market Cap : 123</p>
                    </div>
                    <div class="col">
                        <p> Market Cap : 123</p>
                    </div>
                    <div class="col">
                        <p> Market Cap : 123</p>
                    </div>



                </div>
            </div>

        </div>



    </div>

    <div class="row">
        <div id="left-graph-ticker-container" class="col-9">
            sometf
            <canvas id="stock-chart"> </canvas>

        </div>
        <div id="right-tweet-container" class="col">

            <div class="well">
                <div class="media">
                    <a class="pull-left" href="#">
                        <img class="media-object" src="http://placekitten.com/150/150" width="100" height="100">
                    </a>
                    <div class="media-body">
                        <h4 class="media-heading">Receta 1</h4>
                        <p class="text-right">By Francisco</p>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate. Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis dolor, in sagittis nisi.ccwccwcwcdccwdcwcwcff</p>
                        <ul class="list-inline list-unstyled">
                            <li><span><i class="glyphicon glyphicon-calendar"></i> 2 days, 8 hours </span></li>
                            <li>|</li>
                            <span><i class="glyphicon glyphicon-comment"></i> 2 comments</span>
                            <li>|</li>
                            <li>
                                <span class="glyphicon glyphicon-star"></span>
                                <span class="glyphicon glyphicon-star"></span>
                                <span class="glyphicon glyphicon-star"></span>
                                <span class="glyphicon glyphicon-star"></span>
                                <span class="glyphicon glyphicon-star-empty"></span>
                            </li>
                            <li>|</li>
                            <li>
                                <!-- Use Font Awesome http://fortawesome.github.io/Font-Awesome/ -->
                                <span><i class="fa fa-facebook-square"></i></span>
                                <span><i class="fa fa-twitter-square"></i></span>
                                <span><i class="fa fa-google-plus-square"></i></span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>


        </div>



    </div>






    <!-- 
    {% autoescape off %}
    {{ tweets }}
    {% endautoescape %} -->

</div>

{% endblock %} {% block scripts %}
<script>
    //   const labelsx = [
    //     'January',
    //     'February',
    //     'March',
    //     'April',
    //     'May',
    //     'June',
    //   ];

    //   const data = {
    //     labels: labelsx,
    //     datasets: [{
    //       label: 'My First dataset',
    //       backgroundColor: 'rgb(255, 99, 132)',
    //       borderColor: 'rgb(255, 99, 132)',
    //       data: [0, 10, 5, 2, 20, 30, 45],
    //     }]
    //   };

    //   const config = {
    //                 type: 'line',
    //                 data: data,
    //                 options: {
    //                     xAxes: [{
    //                     type: 'time',
    //                     time: {
    //                         parser: 'YYYY-MM-DD HH:mm:ss',
    //                         unit: 'minute',
    //                         displayFormats: {
    //                             'minute': 'YYYY-MM-DD HH:mm:ss',
    //                             'hour': 'YYYY-MM-DD HH:mm:ss'
    //                         }
    //                     },
    //                     ticks: {
    //                         source: 'data'
    //                     }
    //                 }]        }
    //              };

    //   const myChart = new Chart(
    //     document.getElementById('myChart'),
    //     config
    //   );





    let myApp = Vue.createApp({
        delimiters: ["[[", "]]"],
        data() {
            return {
                currentPrice: 0,
                stockSocket: null,


            }
        },

        async created() {

            var stockPath = window.location.pathname.split('/');
            var stockSingle = stockPath[2]

            this.stockSocket = new WebSocket(
                'ws://' +
                window.location.host +
                '/ws/singlestock/' +
                stockSingle + '/'

            );
            console.log(this.stockSocket)
            let self = this
            this.stockSocket.onmessage = function(e) {
                if (typeof e !== 'undefined') {
                    var response = JSON.parse(e.data);
                    console.log(response);

                    self.currentPrice = response.latestPrice;


                };




            };

            this.stockSocket.onclose = function(e) {
                console.log(e.error)
                console.error('Chat socket closed unexpectedly');
            };


            //make a get request
            var pathArray = window.location.pathname.split('/');
            console.log(pathArray[2])
            var urlWithPath = "{%url 'singleticker:get_current_quote' 2000000000000000%}".replace("2000000000000000", pathArray[2])
            let response = await fetch(urlWithPath);
            if (response.ok) {
                let data = await response.json();
                console.log(data.stock_quote)
                this.currentPrice = data.stock_quote.latestPrice
            } else {
                alert("failed to load the list of hobbies");
            }
        },
        methods: {
            async createNewHobby() {}
        }
    })
    myApp.mount('#app')
</script>
{% endblock %}